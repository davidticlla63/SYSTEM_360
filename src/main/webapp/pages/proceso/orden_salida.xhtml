<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	template="/WEB-INF/templates/template_main.xhtml">
	<ui:define name="head">
		<title>Orden Salida</title>

		<f:event listener="#{ordenSalidaController.initConversation}"
			type="preRenderView"></f:event>

		<h:outputScript name="js/calendar-localization.js" />

	</ui:define>

	<ui:define name="content">
		<!--BEGIN CONTENT-->
		<div class="content">

			<section class="main-content"
				style="background-color: #f5f6f6; padding-top: 0px;">

				<h:form id="form001">

					<div class="row" style="background-color: #f9fafa;">
						<section class="content-header">

							<div class="pull-left"
								style="padding-top: 8px; padding-left: 10px;">
								<div class="btn-group-demo">
									<div class="btn-group">

										<p:commandLink id="buttonAtras" value="&#160; Atras"
											styleClass="btn btn-warning ion-minus-circled"
											rendered="#{ ! ordenSalidaController.verReport}"
											style="height:31px; padding:center"
											onclick="window.location='#{facesContext.externalContext.requestContextPath}/pages/proceso/list-orden-salida.xhtml';">
										</p:commandLink>

										<p:commandLink id="buttonCancelar" value="&#160; Cancelar"
											styleClass="btn btn-warning ion-minus-circled"
											update="form001"
											rendered="#{ordenSalidaController.modificar or ordenSalidaController.registrar or ordenSalidaController.selectedOrdenSalida != null}"
											style="height:31px; padding:center"
											action="#{ordenSalidaController.initNewOrdenSalida()}">
										</p:commandLink>

										<p:commandLink id="buttonRegistrar" value="&#160; Registrar"
											styleClass="btn btn-success ion-checkmark"
											rendered="#{ ! ordenIngresoController.verReport}"
											update="form001" style="height:31px; padding:center"
											action="#{ordenSalidaController.registrarOrdenSalida()}">
										</p:commandLink>

										<p:commandLink id="buttonVerModificar"
											value="&#160; Modificar"
											styleClass="btn btn-primary ion-edit"
											rendered="#{ordenSalidaController.selectedOrdenSalida != null and ordenSalidaController.verProcesar and ! ordenSalidaController.verReport }"
											style="height:31px; padding:center" update="form001"
											action="#{ordenSalidaController.cambiarAspectoModificar()}">
										</p:commandLink>

										<p:commandLink id="buttonModificar" value="&#160; Modificar"
											styleClass="btn btn-primary ion-edit"
											rendered="#{ordenSalidaController.modificar and ordenSalidaController.verProcesar }"
											style="height:31px; padding:center" update="form001"
											action="#{ordenSalidaController.modificarOrdenSalida()}">
										</p:commandLink>

										<p:commandLink id="buttonEliminar" value="&#160; Eliminar"
											styleClass="btn btn-danger ion-close"
											rendered="#{ordenSalidaController.selectedOrdenSalida != null and ordenSalidaController.verProcesar and ! ordenSalidaController.verReport }"
											update="form001"
											onclick="PF('dlgEliminarOrdenSalida').show()"
											style="height:31px; padding:center">
										</p:commandLink>

										<p:commandLink id="buttonProcesar" value="&#160; Procesar"
											styleClass="btn btn-info ion-ios7-loop-strong"
											rendered="#{ordenSalidaController.selectedOrdenSalida != null and ordenSalidaController.verProcesar and ! ordenSalidaController.verReport }"
											style="height:31px; padding:center" update="form001"
											action="#{ordenSalidaController.procesarOrdenSalida()}">
										</p:commandLink>

										<p:commandLink id="buttonVerReporte"
											value="&#160; Ver Reporte"
											styleClass="btn btn-info ion-printer"
											rendered="#{ordenSalidaController.selectedOrdenSalida != null  and ! ordenSalidaController.verReport}"
											style="height:31px; padding:center" update="form001"
											action="#{ordenSalidaController.cargarReporte()}">
										</p:commandLink>

										<p:commandLink id="buttonAnular" value="&#160; Eliminar"
											styleClass="btn btn-danger ion-close" update="form001"
											rendered="#{ordenSalidaController.verButtonAnular}"
											action="#{ordenSalidaController.anularOrden()}"
											style="height:31px; padding:center">
										</p:commandLink>

									</div>
								</div>
							</div>
							<div class="pull-right">
								<ol class="breadcrumb">
									<li><a href="#{request.contextPath}/pages/dashboard.xhtml"
										style="color: #0090FF; font-size: 12px;">Inicio</a></li>
									<li><a
										href="#{request.contextPath}/pages/proceso/orden_salida.xhtml"
										style="color: #0090FF; font-size: 12px;">Proceso</a></li>
									<li class="active" style="font-size: 12px;">Orden Salida</li>
								</ol>
							</div>

						</section>
					</div>
					<!-- BEGIN PANEL REGISTER -->
					<div class="row" style="padding-top: 10px;">
						<div class="col-md-6">
							<ui:fragment
								rendered="#{ ! ordenSalidaController.estaGestionIniciada()}">
								<div class="alert alert-warning alert-dismissable fade in"
									style="height: 28px; padding-top: 5px;">
									<button type="button" data-dismiss="alert" aria-hidden="true"
										class="close">x</button>
									<strong>VALIDACION! </strong>&#160; &#160; &#160; &#160; No
									realizo la toma de inventario inicial #{' '} <a
										href="#{request.contextPath}/pages/proceso/toma_inventario.xhtml">Click
										aquí para configurar</a>
								</div>
							</ui:fragment>
						</div>
					</div>

					<div class="row" style="padding-top: 10px;">

						<ui:fragment rendered="#{ ! ordenSalidaController.verReport}">
							<div class="col-md-4">
								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title">Registro Datos Orden Salida</h3>
									</div>
									<div class="panel-body">
										<!-- start here register -->
										<div class="row">
											<div class="col-md-12 box-content form-horizontal">
												<div class="form-group ">
													<div class="col-md-4">Nº Orden Salida</div>
													<div class="col-md-8">
														<p:inputText id="NroOrdenIngresoID"
															style=" color: #555555; background-image: none;padding: 4px 10px;"
															styleClass="input-sm form-control" size="40"
															readonly="true"
															value="#{ordenSalidaController.newOrdenSalida.correlativo}">
															<p:ajax event="change" />
														</p:inputText>
													</div>
												</div>

												<div class="form-group ">
													<div class="col-md-4">Fecha Pedido</div>
													<div class="col-md-8">
														<p:calendar pattern="dd/MM/yyyy" id="fechaPedido"
															styleClass="myWid100" locale="es"
															value="#{ordenSalidaController.newOrdenSalida.fechaPedido}"
															onkeypress="return permiteKey(event, 'none')"
															style=" color: #555555; background-image: none;">
															<p:ajax event="dateSelect" />
														</p:calendar>
													</div>
												</div>

												<div class="form-group ">
													<div class="col-md-4">Almacén</div>
													<div class="col-md-8">

														<p:autoComplete id="almacenID" style="width: 93%"
															inputStyle="width: 93%; color: #555555; background-image: none;padding: 4px 10px;"
															value="#{ordenSalidaController.selectedAlmacen.nombre}"
															completeMethod="#{ordenSalidaController.completeAlmacen}"
															minQueryLength="3" dropdown="true" required="true"
															requiredMessage="Almacen Requerido."
															forceSelection="true" var="_var" itemLabel="#{_var}"
															itemValue="#{_var.nombre}"
															placeholder="[Escriba Almacén]" scrollHeight="300">

															<p:ajax event="itemSelect" update="form001"
																listener="#{ordenSalidaController.onRowSelectAlmacenClick}" />
															<p:column>
																<h:outputText value="#{_var.nombre}" />
															</p:column>

														</p:autoComplete>
													</div>
												</div>
												<div class="form-group ">
													<div class="col-md-4">Observación</div>
													<div class="col-md-8">
														<p:inputTextarea id="descripcionID"
															style="padding: 4px 10px;" styleClass="form-control"
															size="255"
															value="#{ordenSalidaController.newOrdenSalida.observacion}"
															required="true" requiredMessage="Requerido." rows="5">
															<p:ajax event="change" />
														</p:inputTextarea>
													</div>
												</div>

											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-8">

								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title">Lista de ITEMS</h3>
										<div class="actions mtn">
											<div class="btn-group btn-group-xs">
												<p:commandLink id="buttonDlgTelefono" value="&#160; ITEM"
													styleClass="btn btn-success btn-outlined ion-plus"
													style="height:27px; padding-top: 5px" immediate="true"
													action="#{ordenSalidaController.actionLoadDialogProducto()}">
												</p:commandLink>
												<p:tooltip for="buttonDlgTelefono" value=".">

													<div class="panel">
														<div class="panel-heading">
															<h3 class="panel-title">
																<strong class="text-uppercase text-orange">Información</strong>
															</h3>
														</div>
														<div class="panel-body">
															<p class="mbl">Agregar item al orden de salida</p>
														</div>
													</div>
												</p:tooltip>
											</div>
										</div>
									</div>
									<!-- start here datatable -->
									<div class="box-content no-padding">

										<div class="table-responsive">

											<p:dataTable id="itemsTable1"
												style="font-size: 12px !important; line-height: 1.33846154 !important; font-family: sans-serif !important;"
												selectionMode="single" rowKey="#{_var.id}" var="_var"
												value="#{ordenSalidaController.listaDetalleOrdenSalida}"
												emptyMessage="No se encontraron Registros de ITEMS.">

												<p:column headerText="Nombre ITEM">
													<h:outputText value="#{_var.producto.nombre}" />
												</p:column>

												<p:column headerText="Unidad Medida" width="10%">
													<h:outputText value="#{_var.producto.unidadMedidas.nombre}" />
												</p:column>

												<p:column headerText="Cantidad" width="10%">
													<h:outputText value="#{_var.cantidadSolicitada}" />
												</p:column>

												<p:column headerText="Precio U." width="12%">
													<h:outputText value="#{_var.precioUnitario}">
														<f:convertNumber pattern="#,##0.00" />
													</h:outputText>#{' '}
														<h:outputText value="Bs.-" />
												</p:column>

												<p:column headerText="Total" width="12%">
													<h:outputText value="#{_var.total}">
														<f:convertNumber pattern="#,##0.00" />
													</h:outputText>
												</p:column>

												<p:column headerText="Observación">
													<h:outputText value="#{_var.observacion}" />
												</p:column>

												<p:column width="8%" headerText="Acción"
													style="text-align:center;">
													<div class="row">
														<div class="btn-group-demo">
															<div class="btn-group">
																<p:commandLink id="buttonModificarDetalle"
																	value="&#160;" styleClass="btn ion-edit"
																	style="padding-left: 5px; padding-right: 5px;"
																	immediate="true"
																	actionListener="#{ordenSalidaController.editarDetalleOrdenSalida(_var.id)}" />
																<p:commandLink id="buttonEliminarDetalle"
																	style="padding-left: 5px; padding-right: 5px;"
																	value="&#160;" styleClass="btn ion-trash-b"
																	immediate="true"
																	actionListener="#{ordenSalidaController.borrarDetalleOrdenSalida(_var.id)}" />
															</div>
														</div>
													</div>
												</p:column>

											</p:dataTable>
										</div>
									</div>

									<!-- end here datatable -->
									<div class="panel-body"></div>

								</div>

							</div>

						</ui:fragment>

						<ui:fragment rendered="#{ordenSalidaController.verReport}">
							<div class="col-md-12">
								<div class="panel panel-default">
									<div class="panel-body" style="text-align: center;">
										<p:media player="pdf" rendered="true"
											value="#{ordenSalidaController.urlOrdenSalida}" width="800px"
											height="1125px" />
									</div>
								</div>
							</div>
						</ui:fragment>

					</div>
					<!-- END PANEL TABLE -->
				</h:form>
			</section>
		</div>
		<!--END CONTENT-->

		<!-- START GROWL formGrowl:msgs1 -->
		<h:form id="formGrowl">
			<p:growl id="msgs1" showDetail="true" />
		</h:form>
		<!-- END GROWL -->

		<!--   MODAL PRODUCTO -->
		<p:dialog widgetVar="dlgProducto" resizable="false"
			header="#{ordenSalidaController.tituloProducto}" showHeader="true"
			modal="false" closeOnEscape="true" draggable="true" position="center"
			style="padding: 0px 0px 0px 0px;" width="600"
			visible="#{partidaController.diagloProducto}" id="modalProductoID">
			<h:form id="formDialogProducto">
				<div class="modal-body">
					<div class="row">
						<div class="form-group">
							<label for="codigoID" class="col-sm-3 control-label">Producto</label>
							<div class="col-sm-9">

								<p:autoComplete id="productoID"
									value="#{ordenSalidaController.selectedProducto}"
									converter="productoConverter"
									completeMethod="#{ordenSalidaController.completeProducto}"
									minQueryLength="3" size="35" dropdown="true" required="true"
									requiredMessage="Producto Requerido." forceSelection="true"
									var="_var" itemLabel="#{_var.nombre}" itemValue="#{_var}"
									placeholder="[Escriba Producto]" scrollHeight="300">

									<p:ajax event="itemSelect" update="formDialogProducto,formGrowl"
										listener="#{ordenSalidaController.onRowSelectProductoClick}" />

									<p:column>
										<h:outputText value="#{_var.codigo}" />
									</p:column>
									
									<p:column>
										<h:outputText value="#{_var.nombre}" />
									</p:column>
									
									<p:column>
										<h:outputText value="#{_var.descripcion}" />
									</p:column>

								</p:autoComplete>
							</div>
						</div>
					</div>

					<br />
					<div class="row">
						<div class="form-group">
							<label for="descripcionID" class="col-sm-3 control-label">Observación</label>
							<div class="col-sm-9">
								<p:inputTextarea id="descripcionID" required="true"
									style="padding: 4px 10px;"
									requiredMessage="Observacion Requerido."
									value="#{ordenSalidaController.selectedDetalleOrdenSalida.observacion}"
									size="20" rows="2" cols="39">
									<p:ajax event="change" update="form001" />
								</p:inputTextarea>
							</div>
						</div>
					</div>

					<br />
					<div class="row">
						<div class="form-group">
							<label for="cantidadID" class="col-sm-3 control-label">Cantidad
								Solicitada</label>
							<div class="col-sm-9">
								<p:inputText id="cantidadID" required="true"
									style="padding: 4px 10px;"
									requiredMessage="Cantidad Requerido."
									onkeypress="return validateOnlyNumber(event)"
									value="#{ordenSalidaController.selectedDetalleOrdenSalida.cantidadSolicitada}"
									size="40">
									<p:ajax event="change" update="form001"
										listener="#{ordenSalidaController.calcular()}" />
								</p:inputText>
							</div>
						</div>
					</div>

					<ui:fragment rendered="false">
						<br />
						<div class="row">
							<div class="form-group">
								<label for="totalID" class="col-sm-3 control-label">Total</label>
								<div class="col-sm-9">
									<p:inputText id="totalID" required="true"
										style="padding: 4px 10px;" requiredMessage="Total Requerido."
										disabled="true"
										value="#{ordenSalidaController.selectedDetalleOrdenSalida.total}"
										size="40">
										<p:ajax event="change" />
										<f:convertNumber pattern="#,##0.000" locale="en" />
									</p:inputText>
								</div>
							</div>
						</div>
					</ui:fragment>

					<br />
					<div class="row">
						<div class="col-sm-12">
							<div class="form-group">
								<div class="col-md-4"></div>
								<div class="col-md-4">
									<p:commandLink value="&#160; Cerrar"
										styleClass="btn btn-warning ion-minus-circled btn-block"
										onclick="PF('dlgProducto').hide();"
										action="#{ordenSalidaController.limpiarDatosProducto()}"
										update="form001" immediate="true">
									</p:commandLink>
								</div>
								<div class="col-md-4">
									<p:commandLink value="&#160; Aceptar"
										styleClass="btn btn-success ion-checkmark btn-block"
										rendered="#{ ! ordenSalidaController.editarOrdenSalida}">
										<p:ajax update="form001"
											listener="#{ordenSalidaController.agregarDetalleOrdenSalida()}" />
									</p:commandLink>

									<p:commandLink value="&#160; Modificar"
										styleClass="btn btn-success ion-checkmark btn-block"
										rendered="#{ordenSalidaController.editarOrdenSalida}">
										<p:ajax update="form001"
											listener="#{ordenSalidaController.modificarDetalleOrdenSalida()}" />
									</p:commandLink>
								</div>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>

		<!-- VISTA PREVIA REPORTE -->
		<p:dialog header="ORDEN SALIDA" widgetVar="dlgVistaPreviaOrdenSalida"
			modal="true" visible="#{not empty facesContext.maximumSeverity}"
			resizable="false" position="center" width="750px">
			<h:form id="formModalVistaPrevia">
				<div class="row">
					<div class="form-group ">
						<div class="col-md-12">
							<p:media player="pdf" rendered="true"
								value="#{ordenSalidaController.urlOrdenSalida}" width="100%"
								height="580px" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<div class="form-group">
							<div class="col-md-4"></div>
							<div class="col-md-4"></div>
							<div class="col-md-4">
								<p:commandLink value="Aceptar"
									styleClass="btn btn-primary btn-block"
									onclick="PF('dlgVistaPreviaOrdenIngreso').hide();" />
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>

		<p:dialog header="Desea Eliminar la Orden de Salida"
			widgetVar="dlgEliminarOrdenSalida" modal="true"
			visible="#{not empty facesContext.maximumSeverity}" resizable="false"
			position="center" width="500px">
			<h:form id="formModalEliminarOrdenSalida">

				<div class="row">
					<div class="col-sm-12">
						<div class="form-group">
							<div class="col-md-4"></div>
							<div class="col-md-4">
								<p:commandLink value="&#160; NO"
									styleClass="btn btn-warning ion-minus-circled btn-block"
									onclick="PF('dlgEliminarOrdenSalida').hide();" immediate="true">
								</p:commandLink>
							</div>
							<div class="col-md-4">
								<p:commandLink value="&#160; SI"
									styleClass="btn btn-success ion-checkmark btn-block"
									onclick="PF('dlgEliminarOrdenSalida').hide();">
									<p:ajax update="form001"
										listener="#{ordenSalidaController.eliminarOrdenSalida()}" />
								</p:commandLink>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>
		<!-- END DIALOG -->

		<p:dialog header="ALMACÉN SIN EXISTENCIAS"
			widgetVar="dlgAlmacenSinExistencias" modal="true"
			visible="#{not empty facesContext.maximumSeverity}" resizable="false"
			position="center" width="500px">
			<div class="row">
				<div class="form-group">
					<div class="col-md-12">El Almacén seleccionado no tiene
						Existencias</div>
				</div>
			</div>
			<br />
			<div class="row">
				<div class="form-group">
					<div class="col-md-4"></div>
					<div class="col-md-4"></div>
					<div class="col-md-4"></div>
				</div>
			</div>

		</p:dialog>


		<p:dialog header="VALIDACION DE EXISTENCIAS DE ALMACÉN"
			widgetVar="dlgValidacionExistenciasAlmacen"
			visible="#{not empty facesContext.maximumSeverity}" resizable="false"
			position="center" width="50%">
			<h:form id="dialog100">
				<div class="row">
					<div class="form-group">
						<div class="col-md-12">#{ordenSalidaController.textDialogExistencias}</div>
					</div>
				</div>
				<br />
				<div class="row">
					<div class="form-group">
						<div class="col-md-4"></div>
						<div class="col-md-4"></div>
						<div class="col-md-4">
							<p:commandLink value="&#160; ACEPTAR"
								styleClass="btn btn-success ion-checkmark btn-block"
								onclick="PF('dlgValidacionExistenciasAlmacen').hide();">
							</p:commandLink>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>


	</ui:define>

	<ui:insert name="scripts">

	</ui:insert>
</ui:composition>